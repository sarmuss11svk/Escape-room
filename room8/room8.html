<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Escape Room – 40 interaktívnych úloh (bez opakovania tém)</title>
  <style>
    :root{ --bg:#0b1022; --panel:#0f1630; --card:#131b3d; --stroke:#27306b; --muted:#9fb0ff; --text:#eaf0ff; --accent:#6b8bff; --ok:#2ecc71; --bad:#ff5c5c; --warn:#f1c40f; }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; background:radial-gradient(1000px 500px at 20% -10%, #1b2350 0%, #0b1022 70%), linear-gradient(180deg,#0d1228,#0b1022); color:var(--text)}
    header{position:sticky;top:0;background:rgba(10,13,30,.9);backdrop-filter:blur(8px);z-index:10;border-bottom:1px solid #20285d}
    .wrap{max-width:1200px;margin:auto;padding:16px}
    h1{margin:0;font-size:clamp(22px,3vw,32px)}

    .progress{height:10px;background:#1a2150;border:1px solid #27306b;border-radius:999px;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,#6b8bff,#7ad3ff);width:0%}
    .muted{color:var(--muted)}

    .menu{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin:16px 0}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:16px;padding:14px;box-shadow:0 12px 28px rgb(0 0 0 /.35)}
    .card h3{margin:0 0 6px 0}
    .card button{margin-top:8px;background:var(--accent);border:none;color:white;padding:10px 14px;border-radius:12px;cursor:pointer}

    .game{display:none;margin:18px 0}
    .game.active{display:block}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    .btn{background:var(--accent);border:none;color:white;padding:8px 12px;border-radius:10px;cursor:pointer}
    .btn.ghost{background:#1a2252;border:1px solid #31408b}
    .ok{color:var(--ok);font-weight:700}
    .bad{color:var(--bad);font-weight:700}

    /* MATCH */
    .board{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
    .tile{position:relative;aspect-ratio:3/4;border-radius:12px;cursor:pointer;perspective:800px}
    .face{position:absolute;inset:0;border:1px solid #2b377a;border-radius:12px;display:flex;align-items:center;justify-content:center;padding:10px;text-align:center;transition:transform .5s;backface-visibility:hidden}
    .front{background:#0f1433}
    .back{background:#1a2252;transform:rotateY(180deg)}
    .tile.flipped .front{transform:rotateY(180deg)}
    .tile.flipped .back{transform:rotateY(360deg)}
    .tile.matched{outline:2px solid var(--ok)}

    /* FILL */
    .bank{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
    .token{background:#1a2252;border:1px solid #2f3a82;border-radius:10px;padding:6px 10px;user-select:none}
    .blank{display:inline-block;min-width:90px;padding:4px 8px;border-bottom:2px dashed #3a4ab0;margin:0 4px}
    .blank.filled{border-bottom-color:var(--ok)}

    /* MAZE */
    .maze-wrap{display:grid;grid-template-columns:1fr 280px;gap:12px}
    canvas{background:#0a0f2b;border:1px solid #2b377a;border-radius:12px}
    .kbd{font-family:ui-monospace,monospace;background:#10142f;border:1px solid #2b336b;border-radius:6px;padding:2px 6px}

    /* ORDER */
    .order{display:flex;flex-direction:column;gap:8px}
    .order .row{background:#0f1433;border:1px solid #2a3066;border-radius:10px;padding:8px 10px;cursor:grab}

    /* QUIZ */
    .quiz .q{font-weight:600;margin-bottom:6px}
    .quiz label{display:block;margin:6px 0}

    /* BI-MATCH */
    .two-cols{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .list{background:#0f1433;border:1px solid #2a3066;border-radius:10px;padding:8px}
    .item{padding:6px 8px;border:1px solid #2a3066;border-radius:8px;margin:6px 0;cursor:grab}

    /* SIMON */
    .simon{display:grid;grid-template-columns:repeat(2,120px);gap:10px;justify-content:center}
    .pad{width:120px;height:120px;border-radius:12px;opacity:.85;cursor:pointer}
    .p0{background:#ef4444}.p1{background:#22c55e}.p2{background:#3b82f6}.p3{background:#eab308}
    .pad.active{filter:brightness(1.4)}

    /* SLIDE */
    .slide{display:grid;grid-template-columns:repeat(4,80px);gap:6px;justify-content:center}
    .tile15{width:80px;height:80px;background:#172046;border:1px solid #2a3066;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700}

    @media (max-width:980px){ .menu{grid-template-columns:repeat(auto-fill,minmax(220px,1fr))} .maze-wrap{grid-template-columns:1fr} .board{grid-template-columns:repeat(3,1fr)} }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Escape Room – 40 interaktívnych úloh</h1>
      <div class="muted">Žiadne duplikáty tém: pexeso a dopĺňovačka sú len 1×. Ostatné úlohy majú odlišný obsah. Každá po splnení dá kód.</div>
      <div class="progress" style="margin-top:10px"><div class="bar" id="bar"></div></div>
      <div class="muted" style="margin-top:6px"><span id="done">0</span>/40 splnené</div>
    </div>
  </header>

  <main class="wrap">
    <section class="menu" id="menu"></section>

    <section id="game" class="game">
      <div class="toolbar">
        <button class="btn" id="resetBtn">Reset úlohy</button>
        <button class="btn ghost" id="backBtn">← Späť</button>
        <div id="status" class="muted"></div>
      </div>
      <div id="host"></div>
      <div id="win" style="margin-top:12px;font-weight:700" class="muted"></div>
    </section>
  </main>

  <script>
    const progress = JSON.parse(localStorage.getItem('er40-progress')||'{}');
    function saveProgress(){ localStorage.setItem('er40-progress', JSON.stringify(progress)); }
    function updateHeader(){ const done = LEVELS.filter(l=>progress[l.id]?.done).length; document.getElementById('done').textContent=done; document.getElementById('bar').style.width=(done/LEVELS.length*100)+'%'; }

    // -------- LEVEL DEFINITIONS (40, bez opakovania pexeso/fill) ---------
    const LEVELS = [];
    const L=(o)=>{ LEVELS.push(o); };

    // 1 MATCH (1×)
    L({id:'match1', type:'match', title:'Pexeso: IT pojmy', pairs:[['HTTP 200','OK'],['TLS','šifrovanie + identita'],['alt','atribút pre obrázok'],['DNS A','meno→IPv4'],['JOIN','spojenie tabuliek'],['chmod 750','rwx r-x ---']], code:'MCH-01'});

    // 2 FILL (1×)
    L({id:'fill1', type:'fill', title:'Dopĺňovačka – mix IT', text:"HTTP <b class=blank data-ans=metóda></b> <b class=blank data-ans=GET></b> je bezpečné s <b class=blank data-ans=HTTPS></b>. SQL top: <b class=blank data-ans='ORDER BY'></b> <b class=blank data-ans=DESC></b> <b class=blank data-ans=LIMIT></b> 1.", words:['HTTPS','GET','metóda','ORDER BY','DESC','LIMIT'], code:'FIL-01'});

    // 3–7 MAZE (5× rôzne mapy)
    const MAZES = [
      {id:'maze1', map:[[1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,1,0,0,0,1],[1,0,1,1,0,1,0,1,0,1],[1,0,1,0,0,0,0,1,0,1],[1,0,1,0,1,1,0,0,0,1],[1,0,0,0,1,0,0,1,0,1],[1,1,1,0,0,0,1,1,0,1],[1,0,0,0,1,0,0,0,0,1],[1,0,1,0,0,0,1,0,0,1],[1,1,1,1,1,1,1,1,1,1]], start:[1,1], end:[8,8], code:'MAZ-01'},
      {id:'maze2', map:[[1,1,1,1,1,1],[1,0,0,1,0,1],[1,0,1,0,0,1],[1,0,1,0,1,1],[1,0,0,0,0,1],[1,1,1,1,1,1]], start:[1,1], end:[4,4], code:'MAZ-02'},
      {id:'maze3', map:[[1,1,1,1,1,1,1,1],[1,0,0,0,1,0,0,1],[1,0,1,0,0,0,1,1],[1,0,1,1,1,0,0,1],[1,0,0,0,1,0,1,1],[1,1,1,0,0,0,0,1],[1,1,1,1,1,1,0,1],[1,1,1,1,1,1,1,1]], start:[1,1], end:[6,5], code:'MAZ-03'},
      {id:'maze4', map:[[1,1,1,1,1,1,1],[1,0,0,1,0,0,1],[1,0,1,1,0,1,1],[1,0,0,0,0,0,1],[1,1,1,0,1,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]], start:[1,1], end:[5,5], code:'MAZ-04'},
      {id:'maze5', map:[[1,1,1,1,1],[1,0,0,0,1],[1,1,0,1,1],[1,0,0,0,1],[1,1,1,1,1]], start:[1,1], end:[3,3], code:'MAZ-05'}
    ];
    MAZES.forEach(m=> L({id:m.id, type:'maze', title:'Bludisko', map:m.map, start:m.start, end:m.end, code:m.code}));

    // 8–12 ORDER (5× rôzne poradia)
    L({id:'order1', type:'order', title:'OSI poradie', items:['1 Fyzická','2 Linková','3 Sieťová','4 Transportná','5 Relačná','6 Prezentačná','7 Aplikačná'], shuffled:true, code:'ORD-01'});
    L({id:'order2', type:'order', title:'TCP handshake', items:['SYN','SYN-ACK','ACK'], shuffled:true, code:'ORD-02'});
    L({id:'order3', type:'order', title:'Git – FF merge', items:['checkout main','merge feature'], shuffled:true, code:'ORD-03'});
    L({id:'order4', type:'order', title:'HTTP životný cyklus', items:['Client → Request','Server spracuje','Server → Response','Client render'], shuffled:true, code:'ORD-04'});
    L({id:'order5', type:'order', title:'CI/CD pipeline', items:['Build','Test','Deploy'], shuffled:true, code:'ORD-05'});

    // 13–20 QUIZ (8× unikátne otázky)
    L({id:'quiz1', type:'quiz', title:'Kvíz – web', q:'Aký status má úspech?', choices:['201','200','204'], ans:'200', code:'QZ-01'});
    L({id:'quiz2', type:'quiz', title:'Kvíz – siete', q:'Spoľahlivý protokol?', choices:['UDP','TCP'], ans:'TCP', code:'QZ-02'});
    L({id:'quiz3', type:'quiz', title:'Kvíz – SQL', q:'Funkcia pre počet riadkov?', choices:['SUM()','COUNT()','LEN()'], ans:'COUNT()', code:'QZ-03'});
    L({id:'quiz4', type:'quiz', title:'Kvíz – bezpečnosť', q:'Je hash reversibilný?', choices:['Áno','Nie'], ans:'Nie', code:'QZ-04'});
    L({id:'quiz5', type:'quiz', title:'Kvíz – OS', q:'Príkaz na aktuálny priečinok', choices:['whoami','pwd','cd ..'], ans:'pwd', code:'QZ-05'});
    L({id:'quiz6', type:'quiz', title:'Kvíz – Git', q:'Ako odošleš zmeny?', choices:['git push','git send','git ship'], ans:'git push', code:'QZ-06'});
    L({id:'quiz7', type:'quiz', title:'Kvíz – HTML', q:'Atribút pre alternatívny text?', choices:['title','alt','name'], ans:'alt', code:'QZ-07'});
    L({id:'quiz8', type:'quiz', title:'Kvíz – DNS', q:'Záznam pre IPv4?', choices:['AAAA','CNAME','A'], ans:'A', code:'QZ-08'});

    // 21–23 REGEX (3×)
    L({id:'rx1', type:'regex', title:'RegEx číslice', sample:'ID: 12-34-56', ask:'Zvýrazni dvojciferné bloky (napíš vzor)', must:/\b\d{2}\b/, code:'RX-01'});
    L({id:'rx2', type:'regex', title:'RegEx email', sample:'kontakt: test@example.com, x@y.z', ask:'Jednoduchý vzor pre email', must:/[^\s@]+@[^\s@]+\.[^\s@]+/, code:'RX-02'});
    L({id:'rx3', type:'regex', title:'RegEx IPv4', sample:'Candidates: 10.0.0.1; 256.1.1.1; 192.168.1.5', ask:'Zjednodušený vzor na IPv4', must:/\b(\d{1,3}\.){3}\d{1,3}\b/, code:'RX-03'});

    // 24–28 CONVERT (5×)
    L({id:'cv1', type:'convert', title:'Binárne → dec', prompt:'101010 = ?', answer:'42', code:'CV-01'});
    L({id:'cv2', type:'convert', title:'Hex → text', prompt:'0x48 0x69 → ?', answer:'Hi', code:'CV-02'});
    L({id:'cv3', type:'convert', title:'Base64 → text', prompt:'U0VDUkVUX0tFWQ== → ?', answer:'SECRET_KEY', code:'CV-03'});
    L({id:'cv4', type:'convert', title:'Caesar -3', prompt:'KHOOR → ?', answer:'HELLO', code:'CV-04'});
    L({id:'cv5', type:'convert', title:'Dec → binárne', prompt:'42 → ?', answer:'101010', code:'CV-05'});

    // 29–32 BI-MATCH (4×)
    L({id:'bm1', type:'bimatch', title:'Služba ↔ Port I', left:['HTTP','HTTPS','SSH'], right:['80','22','443'], pairs:{'HTTP':'80','HTTPS':'443','SSH':'22'}, code:'BM-01'});
    L({id:'bm2', type:'bimatch', title:'Služba ↔ Port II', left:['DNS','FTP','SMTP'], right:['21','53','25'], pairs:{'DNS':'53','FTP':'21','SMTP':'25'}, code:'BM-02'});
    L({id:'bm3', type:'bimatch', title:'DB Porty', left:['MySQL','PostgreSQL','MongoDB'], right:['5432','3306','27017'], pairs:{'MySQL':'3306','PostgreSQL':'5432','MongoDB':'27017'}, code:'BM-03'});
    L({id:'bm4', type:'bimatch', title:'HTTP metódy', left:['GET','POST','DELETE'], right:['čítanie','vytvorenie','mazanie'], pairs:{'GET':'čítanie','POST':'vytvorenie','DELETE':'mazanie'}, code:'BM-04'});

    // 33–34 SIMON (2×)
    L({id:'si1', type:'simon', title:'Simon – úroveň 1', len:4, code:'SI-01'});
    L({id:'si2', type:'simon', title:'Simon – úroveň 2', len:6, code:'SI-02'});

    // 35–38 SLIDE (4×)
    L({id:'sl1', type:'slide', title:'15-puzzle – 3×3', size:3, code:'SL-01'});
    L({id:'sl2', type:'slide', title:'15-puzzle – 4×4 A', size:4, code:'SL-02'});
    L({id:'sl3', type:'slide', title:'15-puzzle – 4×4 B', size:4, shuffle:80, code:'SL-03'});
    L({id:'sl4', type:'slide', title:'15-puzzle – 4×4 C', size:4, shuffle:120, code:'SL-04'});

    // 39–40 EXTRA QUIZ (2× unikátne)
    L({id:'quiz9', type:'quiz', title:'Kvíz – CSS', q:'Media query pre tmavý motív?', choices:['prefers-reduced-motion','prefers-color-scheme','color-gamut'], ans:'prefers-color-scheme', code:'QZ-09'});
    L({id:'quiz10', type:'quiz', title:'Kvíz – Docker', q:'Ako sa volá súbor s inštrukciami pre image?', choices:['Containerfile','Dockerfile','Imagefile'], ans:'Dockerfile', code:'QZ-10'});

    // -------- MENU RENDER ---------------------------------------------------
    const menu = document.getElementById('menu');
    function renderMenu(){
      menu.innerHTML = LEVELS.map((l,i)=>`<div class=card><h3>${i+1}. ${l.title}</h3><div class=muted>Typ: ${l.type}</div><button data-go="${l.id}">${progress[l.id]?.done? 'Znova' : 'Spustiť'}</button></div>`).join('');
      menu.querySelectorAll('button[data-go]').forEach(b=> b.onclick = ()=> openLevel(b.dataset.go));
      updateHeader();
    }

    // -------- OPEN LEVEL ----------------------------------------------------
    const host = document.getElementById('host');
    const gameSec = document.getElementById('game');
    document.getElementById('backBtn').onclick = ()=>{ gameSec.classList.remove('active'); menu.style.display='grid'; host.innerHTML=''; document.getElementById('win').textContent=''; };
    document.getElementById('resetBtn').onclick = ()=> current && initLevel(current);

    let current=null;
    function openLevel(id){ current=id; menu.style.display='none'; gameSec.classList.add('active'); initLevel(id); }

    function setWin(code){ document.getElementById('win').innerHTML = `✔ Hotovo! Kód: <b>${code}</b>`; progress[current]={done:true,code}; saveProgress(); updateHeader(); }

    // -------- INIT LEVEL BY TYPE -------------------------------------------
    function initLevel(id){ const lvl = LEVELS.find(x=>x.id===id); host.innerHTML=''; document.getElementById('status').textContent=''; if(!lvl) return; 
      if(lvl.type==='match') return initMatch(lvl); 
      if(lvl.type==='fill') return initFill(lvl);
      if(lvl.type==='maze') return initMaze(lvl);
      if(lvl.type==='order') return initOrder(lvl);
      if(lvl.type==='quiz') return initQuiz(lvl);
      if(lvl.type==='regex') return initRegex(lvl);
      if(lvl.type==='convert') return initConvert(lvl);
      if(lvl.type==='bimatch') return initBiMatch(lvl);
      if(lvl.type==='simon') return initSimon(lvl);
      if(lvl.type==='slide') return initSlide(lvl);
    }

    // ---- MATCH -------------------------------------------------------------
    function initMatch(lvl){
      const board=document.createElement('div'); board.className='board'; host.appendChild(board);
      let cards=[], id=0; lvl.pairs.forEach(p=>{ cards.push({gid:++id,txt:p[0]}); cards.push({gid:id,txt:p[1]}); });
      shuffle(cards);
      board.innerHTML = cards.map(c=>`<div class=tile data-gid=${c.gid}><div class=face front></div><div class=face back>${c.txt}</div></div>`).join('');
      let first=null, matches=0, lock=false;
      board.querySelectorAll('.tile').forEach(t=> t.onclick = ()=>{
        if(lock || t.classList.contains('flipped') || t.classList.contains('matched')) return;
        t.classList.add('flipped');
        if(!first){ first=t; return; }
        if(first.dataset.gid===t.dataset.gid){ first.classList.add('matched'); t.classList.add('matched'); first=null; matches++; if(matches===lvl.pairs.length) setWin(lvl.code); }
        else{ lock=true; setTimeout(()=>{ first.classList.remove('flipped'); t.classList.remove('flipped'); first=null; lock=false; }, 650); }
      });
    }

    // ---- FILL --------------------------------------------------------------
    function initFill(lvl){
      const wrap=document.createElement('div'); wrap.className='card'; host.appendChild(wrap);
      const p=document.createElement('p'); p.innerHTML=lvl.text; wrap.appendChild(p);
      const bank=document.createElement('div'); bank.className='bank'; wrap.appendChild(bank);
      const words=[...lvl.words].sort(()=>Math.random()-0.5);
      words.forEach(w=>{ const t=document.createElement('span'); t.className='token'; t.textContent=w; t.draggable=true; t.ondragstart=e=>e.dataTransfer.setData('text/plain', w); bank.appendChild(t); });
      const blanks=[...wrap.querySelectorAll('.blank')];
      blanks.forEach(b=>{ b.ondragover=e=>e.preventDefault(); b.ondrop=e=>{ e.preventDefault(); const w=e.dataTransfer.getData('text/plain'); if(b.dataset.ans===w){ b.textContent=w; b.classList.add('filled'); check(); } else flash('status','✖ Nesprávne'); }; });
      const check=()=>{ const ok=blanks.every(b=>b.textContent===b.dataset.ans); if(ok) setWin(lvl.code); };
    }

    // ---- MAZE --------------------------------------------------------------
    function initMaze(lvl){
      const wrap=document.createElement('div'); wrap.className='maze-wrap'; host.appendChild(wrap);
      const cv=document.createElement('canvas'); cv.width=520; cv.height=520; wrap.appendChild(cv);
      const side=document.createElement('div'); side.className='card'; side.innerHTML='<h3>Ovládanie</h3><p class=muted><span class=kbd>← ↑ → ↓</span></p>'; wrap.appendChild(side);
      const ctx=cv.getContext('2d'); const W=lvl.map[0].length, H=lvl.map.length; const cell=Math.floor(cv.width/W);
      let pos={x:lvl.start[0], y:lvl.start[1]}; const end={x:lvl.end[0],y:lvl.end[1]};
      draw(); window.onkeydown=(e)=>{ const k=e.key; let nx=pos.x, ny=pos.y; if(k==='ArrowLeft') nx--; if(k==='ArrowRight') nx++; if(k==='ArrowUp') ny--; if(k==='ArrowDown') ny++; if(nx===pos.x&&ny===pos.y) return; if(lvl.map[ny]&&lvl.map[ny][nx]===0){ pos={x:nx,y:ny}; draw(); if(pos.x===end.x&&pos.y===end.y){ setWin(lvl.code); window.onkeydown=null; } }};
      function draw(){ ctx.clearRect(0,0,cv.width,cv.height); for(let y=0;y<H;y++)for(let x=0;x<W;x++){ ctx.fillStyle=lvl.map[y][x]?'#1e2a6b':'#0b112d'; rr(ctx,x*cell,y*cell,cell-2,cell-2,6,true);} ctx.fillStyle='#16a34a'; rr(ctx,lvl.start[0]*cell,lvl.start[1]*cell,cell-2,cell-2,6,true); ctx.fillStyle='#dc2626'; rr(ctx,end.x*cell,end.y*cell,cell-2,cell-2,6,true); ctx.fillStyle='#eab308'; rr(ctx,pos.x*cell+4,pos.y*cell+4,cell-10,cell-10,6,true);} }

    // ---- ORDER -------------------------------------------------------------
    function initOrder(lvl){
      const wrap=document.createElement('div'); wrap.className='order'; host.appendChild(wrap);
      const items = lvl.shuffled? [...lvl.items].sort(()=>Math.random()-0.5) : [...lvl.items];
      items.forEach(txt=>{ const row=document.createElement('div'); row.className='row'; row.textContent=txt; row.draggable=true; row.ondragstart=e=>{ e.dataTransfer.setData('text/plain', txt); e.dataTransfer.dropEffect='move'; row.classList.add('drag'); }; row.ondragend=()=>row.classList.remove('drag'); wrap.appendChild(row); });
      wrap.ondragover=(e)=>{ e.preventDefault(); const dragging=wrap.querySelector('.drag'); const after=getAfterElement(wrap, e.clientY); if(after==null) wrap.appendChild(dragging); else wrap.insertBefore(dragging, after); };
      wrap.ondrop=()=>{ const arr=[...wrap.children].map(c=>c.textContent); if(JSON.stringify(arr)===JSON.stringify(lvl.items)) setWin(lvl.code); };
    }
    function getAfterElement(container, y){ const els=[...container.querySelectorAll('.row:not(.drag)')]; return els.reduce((closest,child)=>{ const box=child.getBoundingClientRect(); const offset=y-box.top-box.height/2; if(offset<0 && offset>closest.offset) return {offset, element:child}; else return closest; }, {offset:Number.NEGATIVE_INFINITY}).element; }

    // ---- QUIZ --------------------------------------------------------------
    function initQuiz(lvl){
      const wrap=document.createElement('div'); wrap.className='quiz card'; host.appendChild(wrap);
      wrap.innerHTML = `<div class=q>${lvl.q}</div>` + lvl.choices.map(c=>`<label><input type=radio name=quiz value="${c}"> ${c}</label>`).join('') + `<button class=btn id=ok>Odovzdať</button>`;
      wrap.querySelector('#ok').onclick=()=>{ const v=wrap.querySelector('input[name=quiz]:checked')?.value||''; if(v==lvl.ans) setWin(lvl.code); else flash('status','✖ Zlá odpoveď'); };
    }

    // ---- REGEX -------------------------------------------------------------
    function initRegex(lvl){
      const wrap=document.createElement('div'); wrap.className='card'; host.appendChild(wrap);
      wrap.innerHTML=`<div class=muted>${lvl.ask}</div><pre style="background:#0a0f2b;border:1px solid #2b377a;border-radius:8px;padding:10px;color:#dbe2ff">${lvl.sample}</pre><input id=rx placeholder="napíš RegEx" style="width:100%;background:#0f1433;border:1px solid #2a3066;border-radius:10px;padding:8px 10px;color:var(--text)"><button class=btn id=chk>Skontrolovať</button>`;
      wrap.querySelector('#chk').onclick=()=>{ try{ const r=new RegExp(document.getElementById('rx').value); if(r.source && r.test(lvl.sample) && lvl.must.test(r.source?lvl.sample: '')) setWin(lvl.code); else flash('status','✖ Skús iný vzor'); }catch{ flash('status','✖ Neplatný RegEx'); } };
    }

    // ---- CONVERT -----------------------------------------------------------
    function initConvert(lvl){
      const wrap=document.createElement('div'); wrap.className='card'; host.appendChild(wrap);
      wrap.innerHTML=`<div class=muted>${lvl.prompt}</div><input id=cv placeholder="odpoveď" style="width:100%;background:#0f1433;border:1px solid #2a3066;border-radius:10px;padding:8px 10px;color:var(--text)"><button class=btn id=ok>Odovzdať</button>`;
      wrap.querySelector('#ok').onclick=()=>{ const v=String(document.getElementById('cv').value).trim(); const ans=String(lvl.answer).trim(); if(v.toLowerCase()===ans.toLowerCase()) setWin(lvl.code); else flash('status','✖ Zlá odpoveď'); };
    }

    // ---- BI-MATCH ----------------------------------------------------------
    function initBiMatch(lvl){
      const wrap=document.createElement('div'); wrap.className='two-cols'; host.appendChild(wrap);
      const left=document.createElement('div'); left.className='list'; left.innerHTML='<h4>Ľavé</h4>'; wrap.appendChild(left);
      const right=document.createElement('div'); right.className='list'; right.innerHTML='<h4>Pravé</h4>'; wrap.appendChild(right);
      const sel={l:null};
      lvl.left.forEach(t=>{ const el=document.createElement('div'); el.className='item'; el.textContent=t; el.onclick=()=>{ sel.l=t; mark(); }; left.appendChild(el); });
      const pairsMade={};
      lvl.right.forEach(t=>{ const el=document.createElement('div'); el.className='item'; el.textContent=t; el.onclick=()=>{ if(sel.l){ const need=lvl.pairs[sel.l]; if(need===t){ el.style.background='#134e4a'; left.querySelectorAll('.item').forEach(i=>{ if(i.textContent===sel.l) i.style.background='#134e4a'; }); pairsMade[sel.l]=t; sel.l=null; mark(); check(); } else { flash('status','✖ Nesprávne párovanie'); } } }; right.appendChild(el); });
      function mark(){ left.querySelectorAll('.item').forEach(i=> i.style.outline = (i.textContent===sel.l)? '2px solid #6ee7b7':'' ); }
      function check(){ if(Object.keys(pairsMade).length===Object.keys(lvl.pairs).length) setWin(lvl.code); }
    }

    // ---- SIMON -------------------------------------------------------------
    function initSimon(lvl){
      const wrap=document.createElement('div'); wrap.className='card'; host.appendChild(wrap);
      const grid=document.createElement('div'); grid.className='simon'; wrap.appendChild(grid);
      const pads=[0,1,2,3].map(i=>{ const d=document.createElement('div'); d.className='pad p'+i; grid.appendChild(d); return d; });
      const seq=[]; const user=[]; function next(){ seq.push(Math.floor(Math.random()*4)); show(); }
      function show(){ let i=0; const iv=setInterval(()=>{ pads.forEach(p=>p.classList.remove('active')); pads[seq[i]].classList.add('active'); setTimeout(()=>pads[seq[i]].classList.remove('active'),250); i++; if(i>=seq.length){ clearInterval(iv); user.length=0; } },450); }
      pads.forEach((p,idx)=> p.onclick=()=>{ user.push(idx); const n=user.length; if(user[n-1]!==seq[n-1]){ flash('status','✖ Zlá sekvencia'); user.length=0; show(); return; } if(user.length===seq.length){ if(seq.length>= (lvl.len||4)) setWin(lvl.code); else next(); } });
      next();
    }

    // ---- SLIDE -------------------------------------------------------------
    function initSlide(lvl){
      const wrap=document.createElement('div'); wrap.className='card'; host.appendChild(wrap);
      const grid=document.createElement('div'); grid.className='slide'; wrap.appendChild(grid);
      const n=lvl.size||4; const cells=[]; for(let i=1;i<n*n;i++) cells.push(i); cells.push('');
      shuffle(cells); if(lvl.shuffle){ for(let i=0;i<lvl.shuffle;i++){ moveRandom(); } }
      render();
      function render(){ grid.innerHTML=''; cells.forEach((v,i)=>{ const d=document.createElement('div'); d.className='tile15'; d.textContent=v; d.onclick=()=>move(i); grid.appendChild(d); }); check(); }
      function move(i){ const z=cells.indexOf(''); const adj=[z-1,z+1,z-n,z+n]; if(adj.includes(i)){ [cells[i],cells[z]]=[cells[z],cells[i]]; render(); } }
      function moveRandom(){ const z=cells.indexOf(''); const opts=[z-1,z+1,z-n,z+n].filter(i=>i>=0&&i<cells.length); const i=opts[Math.floor(Math.random()*opts.length)]; [cells[i],cells[z]]=[cells[z],cells[i]]; }
      function check(){ const ok=cells.slice(0,-1).every((v,i)=>v===i+1); if(ok) setWin(lvl.code); }
    }

    // ----------------- HELPERS ---------------------------------------------
    function rr(c,x,y,w,h,r,fill){ c.beginPath(); c.moveTo(x+r,y); c.arcTo(x+w,y,x+w,y+h,r); c.arcTo(x+w,y+h,x,y+h,r); c.arcTo(x,y+h,x,y,r); c.arcTo(x,y,x+w,y,r); if(fill){ c.fill(); } c.strokeStyle='#2b377a'; c.stroke(); }
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
    function flash(id,msg){ const el=document.getElementById(id); if(!el) return; el.textContent=msg; el.style.color='var(--bad)'; setTimeout(()=>{el.textContent=''; el.style.color='var(--muted)';},900); }

    // INIT
    renderMenu();
  </script>
</body>
</html>
